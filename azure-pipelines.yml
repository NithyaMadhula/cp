trigger:
- main  # Or your target branch

pool:
  name: TR_Pool

variables:
  buildConfiguration: 'Release'

steps:

# ðŸ§° NuGet (packages.config) Restore for .NET Framework projects
- task: NuGetToolInstaller@1
  displayName: 'Install NuGet'

- task: NuGetCommand@2
  displayName: 'Restore NuGet Packages (API)'
  inputs:
    command: 'restore'
    restoreSolution: 'CustomerPortal/CustomerPortal/Api/IGT.CustomerPortal.API/IGT.CustomerPortal.API.sln'

# ðŸ› ï¸ Restore
#- task: DotNetCoreCLI@2
#  displayName: 'Restore NuGet Packages'
#  inputs:
#    command: 'restore'
#    projects: '**/Igt.InstantsShowcase.sln'

- task: DotNetCoreCLI@2
  displayName: 'Restore NuGet Packages (InstantsShowcase)'
  inputs:
    command: 'restore'
    projects: '**/Igt.InstantsShowcase.sln'

# ðŸ§± Build
- task: DotNetCoreCLI@2
  displayName: 'Build Project'
  inputs:
    command: 'build'
    arguments: '--configuration $(buildConfiguration)'
    projects: '**/Igt.InstantsShowcase.sln'
# ðŸ”¹ Step 3: Publish using MSBuild (new, replaces dotnet publish)
- task: MSBuild@1
  displayName: 'Publish Project with MSBuild'
  inputs:
    solution: '**/*.sln'
    msbuildArchitecture: 'x64'
    configuration: '$(buildConfiguration)'
    msbuildArguments: >
      /p:DeployOnBuild=true
      /p:WebPublishMethod=FileSystem
      /p:PublishDir=$(Build.ArtifactStagingDirectory)\publish
      /p:Platform="Any CPU"
# ðŸš€ Publish Artifacts
- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact: drop'
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: 'drop'
    publishLocation: 'Container'
